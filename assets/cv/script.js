// Complete translations for 4 languages
const translations = {
    en: {
        // Navigation
        dir: "ltr",
        home: "Home",
        experience: "Experience",
        education: "Education",
        skills: "Skills",
        projects: "Projects",
        contact: "Contact",
        
        // Hero
        engineering: "Engineering",
        infrastructure: "Infrastructure",
        and: "&",
        roadDesign: "Road Design",
        solutions: "Solutions",
        yearsExperience: "Years Experience",
        projectsCompleted: "Projects Completed",
        countriesServed: "Countries Served",
        viewExperience: "View Experience",
        downloadCv: "Download CV",
        
        // Experience
        experienceSubtitle: "Professional journey and key roles in infrastructure and engineering",
        present: "Present",
        fullTime: "Full-Time",
        remoteSince2025: "Remote Since 2025",
        infrastructureEngineer: "Infrastructure & Road Design Engineer",
        experienceDescription1: "Designed comprehensive infrastructure systems including sewer networks, stormwater drainage, firefighting systems, irrigation, and water supply. Conducted road design, pavement analysis, traffic studies, and intersection planning.",
        notableProjects: "Notable Projects",
        project1: "170-villa compound infrastructure with trapezoidal water channels and box culverts",
        project2: "Hotel infrastructure on archaeological site with specialized drainage protection",
        project3: "Flood management system for hotel with automatic reserve tank design",
        project4: "Wind farm administrative facilities in remote mountainous areas",
        project5: "Residential and commercial complexes in Mongolia with extreme climate adaptation",
        stormwaterManagement: "Stormwater Management",
        roadDesign: "Road Design",
        infrastructurePlanning: "Infrastructure Planning",
        
        sixMonths: "6 Months",
        salesRepresentative: "Sales Representative",
        experienceDescription2: "Managed sales operations, client negotiations, and contract organization. Provided translation support for international clients and developed tailored proposals.",
        salesManagement: "Sales Management",
        clientRelations: "Client Relations",
        contractNegotiation: "Contract Negotiation",
        multilingualSupport: "Multilingual Support",
        
        fiveMonths: "5 Months",
        internship: "Internship",
        traineeEngineer: "Trainee Engineer - Production Department",
        experienceDescription3: "Managed production workflow, supervised teams, and temporarily assumed production chief responsibilities. Developed Excel systems for raw material calculations and inventory control.",
        productionManagement: "Production Management",
        teamSupervision: "Team Supervision",
        inventoryControl: "Inventory Control",
        
        // Education
        bachelorDegree: "Bachelor of Science in Civil Engineering",
        educationDescription: "Combined theoretical foundations with practical application through hands-on training and applied projects. Focused on infrastructure and road design with emphasis on real-world engineering challenges.",
        gpa: "GPA",
        professionalMembership: "Professional Membership",
        chamberEngineers: "Chamber of Civil Engineers in Turkey",
        memberSince2021: "Member since 2021",
        selectedProjects: "Selected Academic Projects",
        roadDesignProject: "Road Design Project",
        roadDesignDescription: "Designed a 1,500-meter road with topographic route selection, cross-section analysis, longitudinal profiling, and earthwork balancing.",
        roadPlanning: "Road Planning",
        urbanInfrastructure: "Urban Infrastructure Design",
        urbanInfrastructureDescription: "Designed sewer, domestic water, and stormwater networks for residential areas with future growth considerations and rainfall intensity estimation.",
        hydraulicDesign: "Hydraulic Design",
        networkPlanning: "Network Planning",
        urbanDevelopment: "Urban Development",
        materialResearch: "Material Research Study",
        materialResearchDescription: "Investigated 'Potential Applications of Diatomite in Cement and Concrete Technology' for sustainable construction materials.",
        materialsScience: "Materials Science",
        sustainability: "Sustainability",
        concreteTechnology: "Concrete Technology",
        
        // Skills
        skillsSubtitle: "Technical expertise and professional competencies developed through education and practical experience",
        technicalExpertise: "Technical Expertise",
        softwareProficiency: "Software Proficiency",
        expert: "Expert",
        advanced: "Advanced",
        intermediate: "Intermediate",
        engineeringCompetencies: "Engineering Competencies",
        infrastructureDesign: "Infrastructure Design",
        hydraulicCalculations: "Hydraulic Calculations",
        trafficAnalysis: "Traffic Analysis",
        projectManagement: "Project Management",
        languages: "Languages",
        arabic: "Arabic",
        native: "Native",
        turkish: "Turkish",
        english: "English",
        upperIntermediate: "Upper Intermediate (B2)",
        additionalCompetencies: "Additional Competencies",
        technicalDevelopment: "Technical Development",
        frontendBackend: "Frontend & Backend Development",
        strategicThinking: "Strategic Thinking",
        chessEnthusiast: "Chess Enthusiast - Intermediate Level",
        creativeWriting: "Creative Writing",
        technicalFiction: "Technical & Fiction Writing",
        
        // Projects
        projectsSubtitle: "Key infrastructure and engineering projects showcasing expertise and innovation",
        villaCompound: "170-Villa Compound",
        villaCompoundDescription: "Complete infrastructure and internal road design for luxury villa compound in Istanbul.",
        stormwaterDrainage: "Stormwater Drainage",
        waterSupply: "Water Supply",
        archaeologicalHotel: "Archaeological Site Hotel",
        archaeologicalHotelDescription: "Infrastructure design for hotel on protected archaeological site with specialized drainage.",
        heritageProtection: "Heritage Protection",
        specialDrainage: "Special Drainage",
        sitePreservation: "Site Preservation",
        floodManagement: "Flood Management System",
        floodManagementDescription: "Automatic reserve tank system for hotel in flood-prone area with smart drainage control.",
        smartSystems: "Smart Systems",
        drainageControl: "Drainage Control",
        
        // Contact
        contactSubtitle: "Feel free to reach out for collaboration, opportunities, or just to connect",
        getInTouch: "Get In Touch",
        location: "Location",
        phone: "Phone",
        email: "Email",
        connectWithMe: "Connect with me",
        name: "Name",
        subject: "Subject",
        message: "Message",
        sendMessage: "Send Message",
        
        // Footer
        copyright: "© 2026 Abdullah Jaffal. All rights reserved.",
        backToTop: "Back to Top"
    },
    
    ar: {
        // Navigation
        dir: "rtl",
        home: "الرئيسية",
        experience: "الخبرة",
        education: "التعليم",
        skills: "المهارات",
        projects: "المشاريع",
        contact: "اتصل بي",
        
        // Hero
        engineering: "الهندسة",
        infrastructure: "البنية التحتية",
        and: "و",
        roadDesign: "تصميم الطرق",
        solutions: "حلول",
        yearsExperience: "سنوات الخبرة",
        projectsCompleted: "مشروع مكتمل",
        countriesServed: "دولة تم العمل بها",
        viewExperience: "عرض الخبرة",
        downloadCv: "تحميل السيرة الذاتية",
        
        // Experience
        experienceSubtitle: "رحلة مهنية وأدوار رئيسية في مجال البنية التحتية والهندسة",
        present: "حالياً",
        fullTime: "دوام كامل",
        remoteSince2025: "عمل عن بُعد منذ 2025",
        infrastructureEngineer: "مهندس تصميم البنية التحتية والطرق",
        experienceDescription1: "تصميم أنظمة بنية تحتية شاملة تشمل شبكات الصرف الصحي، تصريف مياه الأمطار، أنظمة مكافحة الحرائق، الري، وإمدادات المياه. إجراء تصميم الطرق، تحليل الرصف، دراسات المرور، وتخطيط التقاطعات.",
        notableProjects: "مشاريع بارزة",
        project1: "بنية تحتية لمجمع فيلات مكون من 170 فيلا مع قنوات مائية شبه منحرفة وأقبية صندوقية",
        project2: "بنية تحتية لفندق يقع جزئياً على موقع أثري مع حماية تصريف متخصصة",
        project3: "نظام إدارة الفيضانات للفندق مع تصميم خزان احتياطي آلي",
        project4: "مرافق إدارية لمزارع الرياح في مناطق جبلية نائية",
        project5: "مجمعات سكنية وتجارية في منغوليا مع تكييف للمناخ المتطرف",
        stormwaterManagement: "إدارة مياه الأمطار",
        roadDesign: "تصميم الطرق",
        infrastructurePlanning: "تخطيط البنية التحتية",
        
        sixMonths: "6 أشهر",
        salesRepresentative: "مندوب مبيعات",
        experienceDescription2: "إدارة عمليات المبيعات، مفاوضات العملاء، وتنظيم العقود. توفير دعم الترجمة للعملاء الدوليين وتطوير مقترحات مخصصة.",
        salesManagement: "إدارة المبيعات",
        clientRelations: "علاقات العملاء",
        contractNegotiation: "تفاوض العقود",
        multilingualSupport: "دعم متعدد اللغات",
        
        fiveMonths: "5 أشهر",
        internship: "تدريب",
        traineeEngineer: "مهندس متدرب - قسم الإنتاج",
        experienceDescription3: "إدارة سير عمل الإنتاج، إشراف على الفرق، وتولي مسؤوليات رئيس الإنتاج مؤقتاً. تطوير أنظمة Excel لحسابات المواد الخام ومراقبة المخزون.",
        productionManagement: "إدارة الإنتاج",
        teamSupervision: "إشراف الفريق",
        inventoryControl: "مراقبة المخزون",
        
        // Education
        bachelorDegree: "بكالوريوس العلوم في الهندسة المدنية",
        educationDescription: "الجمع بين الأسس النظرية والتطبيق العملي من خلال التدريب العملي والمشاريع التطبيقية. التركيز على تصميم البنية التحتية والطرق مع التركيز على تحديات الهندسة في العالم الحقيقي.",
        gpa: "المعدل التراكمي",
        professionalMembership: "عضوية مهنية",
        chamberEngineers: "غرفة المهندسين المدنيين في تركيا",
        memberSince2021: "عضو منذ 2021",
        selectedProjects: "المشاريع الأكاديمية المختارة",
        roadDesignProject: "مشروع تصميم الطرق",
        roadDesignDescription: "تصميم طريق بطول 1500 متر مع اختيار مسار طبوغرافي، تحليل المقطع العرضي، التخطيط الطولي، وتوازن أعمال الحفر.",
        roadPlanning: "تخطيط الطرق",
        urbanInfrastructure: "تصميم البنية التحتية الحضرية",
        urbanInfrastructureDescription: "تصميم شبكات الصرف الصحي، المياه المنزلية، ومياه الأمطار للمناطق السكنية مع مراعاة النمو المستقبلي وتقدير شدة هطول الأمطار.",
        hydraulicDesign: "التصميم الهيدروليكي",
        networkPlanning: "تخطيط الشبكات",
        urbanDevelopment: "التنمية الحضرية",
        materialResearch: "دراسة بحثية للمواد",
        materialResearchDescription: "بحث 'التطبيقات المحتملة للدياتومايت في تكنولوجيا الأسمنت والخرسانة' لمواد البناء المستدامة.",
        materialsScience: "علم المواد",
        sustainability: "الاستدامة",
        concreteTechnology: "تكنولوجيا الخرسانة",
        
        // Skills
        skillsSubtitle: "الخبرة التقنية والكفاءات المهنية المكتسبة من خلال التعليم والخبرة العملية",
        technicalExpertise: "الخبرة التقنية",
        softwareProficiency: "الكفاءة في البرامج",
        expert: "خبير",
        advanced: "متقدم",
        intermediate: "متوسط",
        engineeringCompetencies: "الكفاءات الهندسية",
        infrastructureDesign: "تصميم البنية التحتية",
        hydraulicCalculations: "الحسابات الهيدروليكية",
        trafficAnalysis: "تحليل المرور",
        projectManagement: "إدارة المشاريع",
        languages: "اللغات",
        arabic: "العربية",
        native: "اللغة الأم",
        turkish: "التركية",
        english: "الإنجليزية",
        upperIntermediate: "متوسط متقدم (B2)",
        additionalCompetencies: "كفاءات إضافية",
        technicalDevelopment: "التطوير التقني",
        frontendBackend: "تطوير الواجهات الأمامية والخلفية",
        strategicThinking: "التفكير الاستراتيجي",
        chessEnthusiast: "هاوٍ للشطرنج - مستوى متوسط",
        creativeWriting: "الكتابة الإبداعية",
        technicalFiction: "كتابة تقنية وخيالية",
        
        // Projects
        projectsSubtitle: "مشاريع البنية التحتية والهندسية الرئيسية التي تبرز الخبرة والابتكار",
        villaCompound: "مجمع 170 فيلا",
        villaCompoundDescription: "تصميم بنية تحتية كاملة وطرق داخلية لمجمع فيلات فاخر في إسطنبول.",
        stormwaterDrainage: "تصريف مياه الأمطار",
        waterSupply: "إمداد المياه",
        archaeologicalHotel: "فندق الموقع الأثري",
        archaeologicalHotelDescription: "تصميم بنية تحتية لفندق على موقع أثري محمي مع تصريف متخصص.",
        heritageProtection: "حماية التراث",
        specialDrainage: "تصريف خاص",
        sitePreservation: "الحفاظ على الموقع",
        floodManagement: "نظام إدارة الفيضانات",
        floodManagementDescription: "نظام خزان احتياطي آلي للفندق في منطقة معرضة للفيضانات مع تحكم ذكي في التصريف.",
        smartSystems: "أنظمة ذكية",
        drainageControl: "التحكم في التصريف",
        
        // Contact
        contactSubtitle: "لا تتردد في التواصل للتعاون أو الفرص أو مجرد الاتصال",
        getInTouch: "ابق على تواصل",
        location: "الموقع",
        phone: "الهاتف",
        email: "البريد الإلكتروني",
        connectWithMe: "تواصل معي",
        name: "الاسم",
        subject: "الموضوع",
        message: "الرسالة",
        sendMessage: "إرسال الرسالة",
        
        // Footer
        copyright: "© 2026 عبد الله جفال. جميع الحقوق محفوظة.",
        backToTop: "العودة للأعلى"
    },
    
    tr: {
        // Navigation
        dir: "ltr",
        home: "Ana Sayfa",
        experience: "Deneyim",
        education: "Eğitim",
        skills: "Yetenekler",
        projects: "Projeler",
        contact: "İletişim",
        
        // Hero
        engineering: "Mühendislik",
        infrastructure: "Altyapı",
        and: "&",
        roadDesign: "Yol Tasarımı",
        solutions: "Çözümler",
        yearsExperience: "Yıl Deneyim",
        projectsCompleted: "Tamamlanan Proje",
        countriesServed: "Hizmet Verilen Ülke",
        viewExperience: "Deneyimi Görüntüle",
        downloadCv: "CV İndir",
        
        // Experience
        experienceSubtitle: "Altyapı ve mühendislik alanında profesyonel yolculuk ve temel roller",
        present: "Şu Anda",
        fullTime: "Tam Zamanlı",
        remoteSince2025: "2025'ten Beri Uzaktan",
        infrastructureEngineer: "Altyapı ve Yol Tasarım Mühendisi",
        experienceDescription1: "Kanalizasyon ağları, yağmur suyu drenajı, yangın söndürme sistemleri, sulama ve su temini dahil olmak üzere kapsamlı altyapı sistemleri tasarımı. Yol tasarımı, kaplama analizi, trafik çalışmaları ve kavşak planlaması yapıldı.",
        notableProjects: "Önemli Projeler",
        project1: "Yamuk su kanalları ve kutu menfezlerle 170 villalık site altyapısı",
        project2: "Özel drenaj koruması ile arkeolojik alandaki otel altyapısı",
        project3: "Otomatik yedek tank tasarımı ile otel için sel yönetim sistemi",
        project4: "Uzak dağlık alanlarda rüzgar çiftliği idari tesisleri",
        project5: "Aşırı iklim adaptasyonu ile Moğolistan'daki konut ve ticari kompleksler",
        stormwaterManagement: "Yağmur Suyu Yönetimi",
        roadDesign: "Yol Tasarımı",
        infrastructurePlanning: "Altyapı Planlaması",
        
        sixMonths: "6 Ay",
        salesRepresentative: "Satış Temsilcisi",
        experienceDescription2: "Satış operasyonlarının yönetimi, müşteri görüşmeleri ve sözleşme organizasyonu. Uluslararası müşteriler için çeviri desteği sağlandı ve özel teklifler geliştirildi.",
        salesManagement: "Satış Yönetimi",
        clientRelations: "Müşteri İlişkileri",
        contractNegotiation: "Sözleşme Müzakeresi",
        multilingualSupport: "Çok Dilli Destek",
        
        fiveMonths: "5 Ay",
        internship: "Staj",
        traineeEngineer: "Stajyer Mühendis - Üretim Departmanı",
        experienceDescription3: "Üretim iş akışının yönetimi, ekiplerin denetlenmesi ve geçici olarak üretim şefi sorumluluklarının üstlenilmesi. Hammadde hesaplamaları ve envanter kontrolü için Excel sistemleri geliştirildi.",
        productionManagement: "Üretim Yönetimi",
        teamSupervision: "Ekip Denetimi",
        inventoryControl: "Envanter Kontrolü",
        
        // Education
        bachelorDegree: "İnşaat Mühendisliği Lisans Derecesi",
        educationDescription: "Teorik temellerin pratik uygulama ile birleştirilmesi, uygulamalı eğitim ve projeler yoluyla. Gerçek dünya mühendislik zorluklarına odaklanarak altyapı ve yol tasarımına odaklanıldı.",
        gpa: "GPA",
        professionalMembership: "Profesyonel Üyelik",
        chamberEngineers: "Türkiye İnşaat Mühendisleri Odası",
        memberSince2021: "2021'den beri üye",
        selectedProjects: "Seçilmiş Akademik Projeler",
        roadDesignProject: "Yol Tasarım Projesi",
        roadDesignDescription: "Topoğrafik güzergah seçimi, enine kesit analizi, boyuna profil ve kazı-dolgu dengesi ile 1.500 metrelik yol tasarımı.",
        roadPlanning: "Yol Planlaması",
        urbanInfrastructure: "Kentsel Altyapı Tasarımı",
        urbanInfrastructureDescription: "Gelecek nüfus artışı ve yağış yoğunluğu tahmini dikkate alınarak konut alanları için kanalizasyon, içme suyu ve yağmur suyu ağları tasarımı.",
        hydraulicDesign: "Hidrolik Tasarım",
        networkPlanning: "Ağ Planlaması",
        urbanDevelopment: "Kentsel Gelişim",
        materialResearch: "Malzeme Araştırma Çalışması",
        materialResearchDescription: "Sürdürülebilir yapı malzemeleri için 'Diyatomitin Çimento ve Beton Teknolojisinde Potansiyel Uygulamaları' araştırıldı.",
        materialsScience: "Malzeme Bilimi",
        sustainability: "Sürdürülebilirlik",
        concreteTechnology: "Beton Teknolojisi",
        
        // Skills
        skillsSubtitle: "Eğitim ve pratik deneyim yoluyla geliştirilen teknik uzmanlık ve profesyonel yetkinlikler",
        technicalExpertise: "Teknik Uzmanlık",
        softwareProficiency: "Yazılım Yeterliliği",
        expert: "Uzman",
        advanced: "İleri",
        intermediate: "Orta",
        engineeringCompetencies: "Mühendislik Yetkinlikleri",
        infrastructureDesign: "Altyapı Tasarımı",
        hydraulicCalculations: "Hidrolik Hesaplamalar",
        trafficAnalysis: "Trafik Analizi",
        projectManagement: "Proje Yönetimi",
        languages: "Diller",
        arabic: "Arapça",
        native: "Ana Dil",
        turkish: "Türkçe",
        english: "İngilizce",
        upperIntermediate: "Orta Üstü (B2)",
        additionalCompetencies: "Ek Yetkinlikler",
        technicalDevelopment: "Teknik Geliştirme",
        frontendBackend: "Önyüz ve Arka Uç Geliştirme",
        strategicThinking: "Stratejik Düşünme",
        chessEnthusiast: "Satranç Meraklısı - Orta Düzey",
        creativeWriting: "Yaratıcı Yazarlık",
        technicalFiction: "Teknik ve Kurgu Yazımı",
        
        // Projects
        projectsSubtitle: "Uzmanlık ve yenilik sergileyen temel altyapı ve mühendislik projeleri",
        villaCompound: "170 Villalık Site",
        villaCompoundDescription: "İstanbul'da lüks villa sitesi için tam altyapı ve iç yol tasarımı.",
        stormwaterDrainage: "Yağmur Suyu Drenajı",
        waterSupply: "Su Temini",
        archaeologicalHotel: "Arkeolojik Alan Oteli",
        archaeologicalHotelDescription: "Özel drenaj ile korunan arkeolojik alandaki otel için altyapı tasarımı.",
        heritageProtection: "Kültür Mirası Koruma",
        specialDrainage: "Özel Drenaj",
        sitePreservation: "Alan Koruma",
        floodManagement: "Sel Yönetim Sistemi",
        floodManagementDescription: "Sel riskli bölgedeki otel için akıllı drenaj kontrolü ile otomatik yedek tank sistemi.",
        smartSystems: "Akıllı Sistemler",
        drainageControl: "Drenaj Kontrolü",
        
        // Contact
        contactSubtitle: "İşbirliği, fırsatlar veya sadece bağlantı kurmak için iletişime geçmekten çekinmeyin",
        getInTouch: "İletişime Geçin",
        location: "Konum",
        phone: "Telefon",
        email: "E-posta",
        connectWithMe: "Benimle Bağlantı Kurun",
        name: "Ad",
        subject: "Konu",
        message: "Mesaj",
        sendMessage: "Mesaj Gönder",
        
        // Footer
        copyright: "© 2026 Abdullah Jaffal. Tüm hakları saklıdır.",
        backToTop: "Başa Dön"
    }
};

// DOM Elements
const bodyElement = document.body;
const langButtons = document.querySelectorAll('.lang-btn');
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
const contactForm = document.getElementById('contact-form');
const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
const sections = document.querySelectorAll('section[data-section]');
const navName = document.getElementById('nav-name');

// Current language
let currentLang = localStorage.getItem('selectedLang') || 'en';

// Scroll spy state
let currentSection = 'hero';

// Initialize page
function initPage() {
    // Apply saved language
    applyLanguage(currentLang);
    
    // Setup event listeners
    setupEventListeners();
    
    // Setup scroll spy
    setupScrollSpy();
    
    // Setup form
    setupForm();
    
    // Initialize mobile menu
    initMobileMenu();
    
    // Add scroll animation
    setupScrollAnimations();
}

// Function to apply language
function applyLanguage(lang) {
    // Update body direction and lang attribute
    bodyElement.dir = translations[lang].dir || 'ltr';
    bodyElement.lang = lang;
    
    // Update font family based on language
    if (lang === 'ar') {
        bodyElement.style.fontFamily = "'IBM Plex Sans Arabic', sans-serif";
    } else {
        bodyElement.style.fontFamily = "'Inter', sans-serif";
    }
    
    // Update all text elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update placeholders for form inputs
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
    
    // Update active language button
    langButtons.forEach(btn => {
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Update copyright year
    const copyrightElement = document.getElementById('copyright');
    if (copyrightElement && translations[lang] && translations[lang].copyright) {
        copyrightElement.textContent = translations[lang].copyright;
    }
    
    // Save to localStorage
    localStorage.setItem('selectedLang', lang);
    currentLang = lang;
}

// Setup event listeners
function setupEventListeners() {
    // Language buttons
    langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            if (lang !== currentLang) {
                applyLanguage(lang);
            }
        });
    });
    
    // Smooth scrolling for all anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                // Calculate offset for fixed header
                const offset = 80;
                
                window.scrollTo({
                    top: targetElement.offsetTop - offset,
                    behavior: 'smooth'
                });
                
                // Update active nav link
                updateActiveNavLink(targetId.substring(1));
                
                // Close mobile menu if open
                if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        });
    });
}

// Setup scroll spy
function setupScrollSpy() {
    // Create intersection observer
    const observerOptions = {
        root: null,
        rootMargin: '-20% 0px -70% 0px',
        threshold: 0
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const sectionId = entry.target.getAttribute('data-section');
                updateActiveNavLink(sectionId);
            }
        });
    }, observerOptions);
    
    // Observe all sections
    sections.forEach(section => {
        observer.observe(section);
    });
}

// Update active navigation link
function updateActiveNavLink(sectionId) {
    navLinks.forEach(link => {
        if (link.getAttribute('href') === `#${sectionId}`) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
    
    currentSection = sectionId;
}

// Initialize mobile menu
function initMobileMenu() {
    if (!mobileMenuBtn || !mobileMenu) return;
    
    mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        const icon = mobileMenuBtn.querySelector('i');
        if (mobileMenu.classList.contains('hidden')) {
            icon.classList.remove('fa-times');
            icon.classList.add('fa-bars');
        } else {
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-times');
        }
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
            mobileMenu.classList.add('hidden');
            const icon = mobileMenuBtn.querySelector('i');
            icon.classList.remove('fa-times');
            icon.classList.add('fa-bars');
        }
    });
}

// Setup contact form
function setupForm() {
    if (!contactForm) return;
    
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            subject: document.getElementById('subject').value,
            message: document.getElementById('message').value
        };
        
        // Simple validation
        if (!formData.name || !formData.email || !formData.message) {
            alert(currentLang === 'ar' ? 'يرجى ملء جميع الحقول المطلوبة.' : 
                  currentLang === 'tr' ? 'Lütfen tüm gerekli alanları doldurun.' :
                  'Please fill in all required fields.');
            return;
        }
        
        // Show success message
        alert(currentLang === 'ar' ? 'شكراً لك على رسالتك! سأعود إليك قريباً.' :
              currentLang === 'tr' ? 'Mesajınız için teşekkürler! Size en kısa sürede döneceğim.' :
              'Thank you for your message! I will get back to you soon.');
        
        // Reset form
        contactForm.reset();
    });
}

// Setup scroll animations
function setupScrollAnimations() {
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);
    
    sections.forEach(section => {
        observer.observe(section);
    });
}

// Handle responsive adjustments
function handleResponsive() {
    // Check if we need to adjust layout for RTL languages
    if (bodyElement.dir === 'rtl') {
        document.body.classList.add('rtl-layout');
    } else {
        document.body.classList.remove('rtl-layout');
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    initPage();
    handleResponsive();
    window.addEventListener('resize', handleResponsive);
});

// Handle initial scroll position
window.addEventListener('load', () => {
    // If there's a hash in the URL, scroll to it
    if (window.location.hash) {
        const targetElement = document.querySelector(window.location.hash);
        if (targetElement) {
            setTimeout(() => {
                const offset = 80;
                window.scrollTo({
                    top: targetElement.offsetTop - offset,
                    behavior: 'smooth'
                });
                updateActiveNavLink(window.location.hash.substring(1));
            }, 100);
        }
    }
    
    // Add loaded class for animations
    document.body.classList.add('loaded');
});
